---
title: Обновление серверов Opera Mini
authors:
- bruce-lawson
intro: 'Мы обновили сервера Opera Mini до новой версии нашего движка Presto. Подробнее о том, что это значит для веб-разработчиков.'
tags:
- html
- css
- javascript
- opera
- opera-mini
language: ru
published: false
license: cc-by-3.0
---

Мы обновили сервера Opera Mini до новой версии нашего движка Presto. Это значит, что раскладки на Flexbox и единицы измерения `rem` будут работать как вы и ожидали.

Как вы уже наверняка знаете, Opera Mini отрисовывает страницы на серверах Opera и они потом отправляются обратно в клиенты на устройствах в сильно сжатом формате. Это значит, что все пользователи сразу же увидят страницы, отрисованные обновлёнными серверами Mini, им не понадобится обновлять программу для этого. Мы обновили 260 миллионов пользователей всего за одни выходные. Ого.

## Что нового

### HTML5-парсер

Сервера Mini теперь используют Ragnarök, нашу собственную реализацию [алгоритма для HTML5-парсера](https://html.spec.whatwg.org/multipage/syntax.html#parsing). Этот алгоритм как HTML-нинзя — очень мощный, но всегда действует незаметно. Когда мы впервые внедрили его в Opera для компьютеров, то обнаружили, что 20% проблем с совместимостью сайтов исчезли, так что это, казалось бы незаметное, улучшение должно повысить совместимость сайтов.

### Новые типы полей из HTML5

Наши сервера теперь поддерживают типы полей из HTML5 (`tel`, `date`, `number` и т.д.) Мы планируем обновить сами клиенты позднее, чтобы эти поля заработали в поддерживаемых ОС. До тех пор они будут подменяться на `<input type="text">`, как этого и требует спецификация.

### CSS Flexbox

Flexbox (или _CSS Flexible Box Model_, если официально) — это новый способ для создания гибких раскладок в браузере, достаточно гибкий, чтобы страницы хорошо адаптировались даже без медиавыражений. Блоки растягиваются или сжимаются, чтобы занять свободное место, делят пространство поровну для создания раскладок, подобных сеткам, для произвольных ширин. Блоки с содержимым можно визуально менять местами, не трогая исходный HTML-код — например, навигацию слева от содержимого на большом экране (следующую до него в исходном коде) можно переместить после содержимого на узких экранах.

Подробнее:

* [Flexbox — Fast Track to Layout Nirvana?](https://dev.opera.com/articles/flexbox-basics/)
* [Advanced Cross-Browser Flexbox](https://dev.opera.com/articles/advanced-cross-browser-flexbox/)
* [Animating Flexboxes: The Lowdown](https://dev.opera.com/articles/animating-flexboxes-the-lowdown/)

### Единицы измерения `rem`

Единица измерения `rem` равна рассчитанному значению `font-size` корневого элемента. Если вы используете эту единицу в вашем коде, то изменение `font-size` для элемента `<html>` изменит все остальные свойства, выраженные в `rem`.

### ECMAScript 5

Следующия свойства теперь поддерживаются:

* Режим `strict`
* [Зарезервированные слова в качестве имён свойств](https://mathiasbynens.be/notes/javascript-properties)
* [Unicode-символы нулевой ширины в указателях](https://mathiasbynens.be/notes/javascript-identifiers)
* Неизменяемый глобальный `undefined`
* `Function.prototype.bind`
* `Object.defineProperties`
* `Object.freeze`
* `Object.getOwnPropertyDescriptor`
* `Object.getOwnPropertyNames`
* `Object.getPrototypeOf`
* `Object.isExtensible`
* `Object.isFrozen`
* `Object.isSealed`
* `Object.preventExtensions`
* `Object.seal`

Это делает полной нашу поддержку ES5.

## Что же работает в Opera Mini?

До сих пор на кластерах Opera Mini работала версия Opera Presto, аналогичная версии Opera 11 для компьютеров. Она была обновлена до версии, аналогичной Opera 12 для компьютеров, с некоторыми отключёнными возможностями, главным образом, связанными с архитектурными особенностями, например:

* API только для JavaScript не работают в Opera Mini из-за её архитектуры. Другие части JavaScript, однако, работают. Читайте подобнее об [Opera Mini и JavaScript.](https://dev.opera.com/articles/opera-mini-and-javascript/).
* Некоторые CSS-возможности также отключены, например, скруглённые уголки (`border-radius`) и градиенты выключены потому, что после отрисовки на сервере, их придётся отправлять в растровом виде на клиент, что в итоге увеличит изначальный объём страницы, вместо сжатия.
* Веб-шрифты тоже не подгружаются, вместо этого используются системные шрифты устройства. Это происходит потому, что многие устройства не позволяют устанавливать другие шрифты; системные шрифты заведомо лучше оптимизированы для конкретного устройства и выглядят лучше, а также веб-шрифты могут быть довольно большими, что замедляет отрисовку.
* CSS- и SVG-анимации не работают, вместо них отображается только первый кадр.

## Стоит иметь в виду

* Если вы используете CSS-градиенты в качестве фона для текста или кнопок, установите подходящее значение для `background-color`, которое достаточно хорошо контрастирует с текстом, чтобы его можно было прочитать без этого градиента.
* Не полагайтесь на иконочные шрифты, поскольку веб-шрифты не подгружаются. Используйте вместо этого SVG, этот формат можно сделать адаптивным, [см. доклад о том](https://dev.opera.com/blog/how-media-queries-allow-you-to-optimize-svg-icons-for-several-sizes/), как медиавыражения позволяют оптимизировать SVG-иконки для нескольких размеров.
* Если вы полагаетесь на какую-то базу данных IP-адресов для определения местоположения пользователя, обратите внимание, что тот IP-адрес, который вы найдёте в заголовках, принадлежит нашим прокси для сжатия. Оригинальный IP-адрес пользователя передаётся в заголовке `X-Forwarded-For`.
* Задайте себе вопрос «[Должны ли все сайты выглядеть одинаково во всех браузерах?](http://dowebsitesneedtolookexactlythesameineverybrowser.com/)» и не забывайте, что причина, по которой пользователь пришёл на ваш сайт — это его содержимое.

## Тестирование

Мы протестировали всё очень внимательно, но если вам захочется посмотреть, как выглядят ваши страницы, для этого есть несколько способов. 

### Загрузите Opera Mini

Конечно же вы можете установить Opera Mini прямо на ваше устройство. Направьте вашего карманного друга на [m.opera.com](http://m.opera.com/) и загрузите Opera Mini для Android, iOS, Windows Phone или даже для самой простой мобилки — Opera Mini работает на более чем 3000 разных устройств.

Если вы используете версию для iOS, то не забудьте переключить её в режим Mini, чтобы направить трафик через сервера Opera Mini. Нажмите на красную «O» и выберите «Opera Mini». Opera Mini для iOS также сжимает видео. Читайте подробнее [об Opera Mini для iOS](https://dev.opera.com/blog/opera-mini-8-for-ios/).

### Тестирование на компьютере

Для разработки и тестирования может быть полезно установить Opera Mini на ваш компьютер. Для этого вам понадобится Java и MicroEmulator, в котором вы сможете запустить экземпляр Opera Mini для J2ME-телефонов. В руководстве «[Installing Opera Mini on Your Computer](https://dev.opera.com/articles/installing-opera-mini-on-your-computer/)» есть вся нужная информация.

Вы также можете [установить Opera Mini на Chromebook](https://dev.opera.com/articles/opera-mini-chrome-os/). Нет, вы не ослышались.

### Тестирование локальных сайтов с ngrok

Многие разработчики используют [ngrok](https://ngrok.com/) для того, чтобы безопасно открывать локальные сервера в глобальную сеть. Как говорит их сайт: «ngrok создаёт туннель из публичного интернета `https://subdomain.ngrok.com/` до порта на вашем локальном компьютере. Вы можете поделиться этой ссылкой с кем угодно, чтобы он мог посмотреть на вашу работу — не нужно никакого деплоя». Вы просто направляете Opera Mini на `subdomain.ngrok.com`, чтобы протестировать ваш сайт. Код ngrok открыт, проект предлагает и платный сервис.

## В завершение

After months of planning and testing, we’re delighted to bring the magic of ES5, HTML5 Parsing, CSS Flexbox and the glory of the `rem` unit to more than a quarter of a billion users. Meanwhile, we continue to work to make Opera Mini faster and [more widely-available](http://www.operasoftware.com/press/releases/mobile/2014-08-21) to ensure that *everyone* has access to the Web.

После месяцев планирования и тестирования, мы бесконечно рады поделиться магией ES5, HTML5-парсера, Flexbox и торжеством единицы `rem` с более чем четвертью миллиарда пользователей. Тем временем, мы продолжаем работать над тем, чтобы сделать Opera Mini быстрее и [доступнее ещё большему числу пользователей](http://www.operasoftware.com/press/releases/mobile/2014-08-21), чтобы убедиться в том, что доступ в интернет есть *у каждого*.