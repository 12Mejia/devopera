Title: Accessibilité d'une vidéo en HTML5 avec sous-titres en JavaScript
----
Date: 2010-02-09 14:10:02
----
Lang: fr
----
Author: 
----
License: Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported
----
License_url: http://creativecommons.org/licenses/by-nc-sa/3.0/
----
Text:

<h2>Accessibilité et balise video</h2> <p>HTML5 nous permet enfin d&#39;intégrer de la vidéo dans nos pages web, directement lisible par les navigateurs et sans avoir à installer de plugin. Cette fonctionnalité a été ajoutée à <a href="http://my.opera.com/desktopteam/blog/happy-new-year" rel="nofollow">Opera depuis la version 10.5 pre-alpha</a> (Windows et Linux pour le moment, la version Mac est en cours de développement.)</p> <p>Le gros point noir en ce qui concerne la vidéo - qu&#39;il s&#39;agisse d&#39;HTML5 ou de solutions propriétaires - est l&#39;accessibilité. Que peuvent faire les développeurs consciencieux qui voudraient offrir une alternative textuelle à ceux qui ne peuvent accéder à la vidéo ? En HTML5, il n&#39;y a pas d&#39;attribut alt sur l&#39;élément video comme pour l&#39;élément <code>img</code>, mais vous pouvez ajouter un contenu alternatif à l&#39;intérieur de l&#39;élément, comme ceci :</p> <pre><code>&lt;video&gt;
Your browser doesn&#39;t support the open Ogg Theora codec. 
Please &lt;a href=&quot;video.ogg&quot;&gt;download the video&lt;/a&gt; and view offline.
&lt;/video&gt;</code></pre> <p>Cependant, <a href="http://dev.w3.org/html5/spec/video.html#video" rel="nofollow">selon la recommandation</a> :</p> <blockquote>...ce contenu ne devrait pas servir à résoudre des problèmes d&#39;accessibilité. Pour qu&#39;une vidéo soit accessible aux aveugles, aux sourds et aux personnes avec handicaps physiques ou cognitifs, les auteurs devraient fournir des contenus alternatifs et/ou intégrer les aides à l&#39;accessibilité (comme les sous-titres) à l&#39;intérieur du flux vidéo.</blockquote> <p>En théorie, les fichiers vidéo devraient intégrer leurs propres sous-titres - pas plaqués sur les images, mais dans un fichier séparé au format texte, empaqueté dans un fichier conteneur avec la vidéo elle-même. Ainsi, l&#39;auteur du contenu, qui est le mieux placé pour le connaître, écrit les sous-titres une seule fois. La vidéo peut être ensuite facilement intégrée sur d&#39;autres pages, en proposant automatiquement des légendes ou des transcriptions.</p> <p>Malheureusement, en pratique, personne ne sait comment faire, et aucun navigateur ne sait lire ces données, ni de quelle manière les présenter à l&#39;utilisateur. Nous avons donc besoin d&#39;une sorte de hack pour combler ce manque. Voici un exemple (&quot;Proof of concept&quot; en anglais) qui stocke une transcription en texte dans la page, à l&#39;intérieur d&#39;un élément <code>&lt;div id=&quot;transcript&quot;&gt;</code>. Si un utilisateur ne dispose pas de JavaScript, la vidéo est simplement affichée avec les contrôles du navigateur, ainsi qu&#39;une partie &quot;transcript&quot; à la suite, contenant la transcription.</p> <p>Si l&#39;utilisateur dispose de JavaScript, les lignes de la transcription seront superposées une par une au-dessus de la vidéo, comme des légendes. Elles seront encore en texte brut, de sorte que les outils d&#39;assistance pourront accéder aux légendes, tout en étant visible à l&#39;écran, et elles seront synchronisées avec la vidéo.</p> <p>Voici un exemple vidéo démontrant la technique : <a href="http://people.opera.com/brucel/demo/video/accessible-html5-video-captions.html" rel="nofollow">Exemple de vidéo sous-titrée - How to Leverage a Synergy</a>. (Vous devez utiliser un <a href="http://my.opera.com/desktopteam/blog/happy-new-year" rel="nofollow">navigateur disposant du codec vidéo Ogg</a>).</p> <p>Cette exemple ne fonctionne pas dans Safari, car Safari ne prend pas en charge le codec vidéo Ogg que Opera, Firefox et Chrome prennent en charge.  La démo fonctionne si vous encodez la vidéo pour Safari aussi, et utilisez <a href="http://dev.w3.org/html5/spec/video.html#the-source-element" rel="nofollow">des éléments <code>source</code></a> multiples (un pour Ogg, un pour mp4). Internet Explorer ne prend pas encore en charge les éléments <code>video</code></p> <p class="note">Si vous affichez le code source, vous verrez que la transcription est structurée sémantiquement à l&#39;aide de paragraphes, et chaque sous-titre est placé à l&#39;intérieur d&#39;un élément <code>span</code> pour se superposer à la vidéo, car ce qui est affiché et quand il doit être affiché n&#39;est pas défini par le sens mais par le temps et les contraintes d&#39;affichage (ne pas remplir l&#39;écran de texte par exemple).</p> <p>Pour que le script sache quand afficher chaque sous-titre, j&#39;ai ajouté des informations de temps pour chacun d&#39;eux. Plutôt que de les ajouter dans le contenu, j&#39;utilise une nouvelle fonctionnalité de HTML5, <a href="http://dev.w3.org/html5/spec/dom.html#embedding-custom-non-visible-data" rel="nofollow">l&#39;attribut personnalisé <abbr>data-</abbr></a>. Cet attribut permet de transmettre des données à des scripts. Vous pouvez utiliser le nom que vous souhaitez pour ces attributs, mais ils doivent impérativement commencer par &quot;data-&quot;. Dans cet exemple, j&#39;ai utilisé <code>data-begin</code> et <code>data-end</code>. Ces noms correspondent aux <a href="http://www.w3.org/TR/2009/CR-ttaf1-dfxp-20090924/#timing-attribute-vocabulary" rel="nofollow">spécifications &quot;W3C Timed Text&quot;</a> et <a href="http://www.w3.org/TR/SVG/animate.html#TimingAttributes" rel="nofollow">&quot;SVG/SMIL Animation&quot;</a>.</p><p>L&#39;attribut <code>data-begin&lt;c/ode&gt; prend comme valeur le temps écoulé depuis le début de la vidéo, à partir duquel je souhaite faire apparaître le <code>span</code>. L&#39;attribut <code>data-end</code> est ensuite utilisé pour définir le moment où le sous-titre doit disparaître. Ainsi :</code></p> <pre><code>&lt;span data-begin=1 data-end=6&gt;Hi, my name&#39;s Dr Archimedes Einstein…&lt;/span&gt;</code></pre> <p>affiche ce sous-titre une seconde après le début de la vidéo, puis le fait disparaître 6 secondes après le début de la vidéo (donc 5 secondes d&#39;affichage en tout).</p> <p>Le script masque alors alors l&#39;élément <code>div</code> qui abrite la transcription en clair (j&#39;utilise JavaScript pour définir une régle <code>display:none</code> en CSS). Il récupère ensuite chaque élément <code>span</code> à l&#39;intérieur de l&#39;élément <code>div</code> masqué :</p> <pre><code>var nodes = document.querySelectorAll(&#39;#transcript span&#39;);</code></pre> <p>Nous avons maintenant besoin de les positionner sur la vidéo au bon moment. La superposition du texte est simple, j&#39;ai tout simplement positionné un autre élément div (dont l&#39;id est <code>captions</code>) au-dessus de la vidéo. Pour augmenter la lisibilité du texte blanc sur fond clair, je vais également ajouter une légère ombre au texte en utilisant CSS :</p> <pre><code>text-shadow: black 1px 1px 3px;</code></pre> <p>Pour déterminer à quel moment superposer chaque <code>span</code>, le script utilise l&#39;événement <code>ontimeupdate</code> (que l&#39;élément vidéo déclenche environ toutes les 250ms avec Opera) pour interroger l&#39;API vidéo et récupérer le temps écoulé depuis le début :</p> <pre><code>var v = document.querySelector(&#39;video&#39;); 
var now = v.currentTime;</code></pre> <p>puis on boucle sur chaque élément <code>span</code> dans la transcription jusqu&#39;à en trouver un dont les valeurs <code>data-begin</code> et <code>data-end</code> englobent le temps écoulé.</p> <p>Dans cet exemple, j&#39;utilise du contenu généré en CSS pour afficher les horodatages lorsque Javascript est désactivé :</p> <pre><code>#transcript [data-begin]:before 
  {content: &quot; [&quot; attr(data-begin) &quot;s-&quot; 
  attr(data-end)&quot;s] &quot;; 
  font-size:80%;}</code></pre> <p>et je le formate en utilisant des règles CSS. Ces deux dernières étapes sont entièrement facultatives.</p> <p class="note">Comme je l&#39;ai dit plus haut, il s&#39;agit d&#39;un hack. Il demande beaucoup de travail aux développeurs (bien que cela soit vrai pour n&#39;importe quel type de sous-titrage, pour lequel il faut transcrire la piste audio et noter les informations de temps, ce qui est déjà un gros travail). </p> <p>Quelques problèmes subsistent avec ce script. Premièrement, si je définis des abréviations dans les sous-titres avec <code>abbr</code> ou d&#39;autres langues avec <code>span lang=</code>, le navigateur n&#39;affichera pas celles-ci en même temps que les sous-titres synchronisés (bien que ce ne soit pas forcément très important). Je n&#39;ai pas essayé d&#39;inclure des informations WAI-ARIA, comme <code>aria-describedby</code> (mais je serais intéressé par un retour d&#39;expérience concernant le fonctionnement avec ARIA).</p> <p>En outre, pour que ce code soit utilisable en production les utilisateurs devraient avoir la possibilité de voir la transcription plutôt que des légendes, même si elles sont en cours d&#39;exécution JavaScript - peut-être qu&#39;ils utilisent un téléphone mobile et ne veulent pas télécharger la vidéo entière, mais qui veulent pouvoir consulter le contenu en texte brut.</p> <p>Le code est fourni sous licence Creative Commons, donc n&#39;hésitez pas à le modifier, et à m&#39;envoyer un email ou un <a href="http://www.twitter.com/brucel" rel="nofollow">message via twitter</a> si vous le faites.</p> <h2 id="more">En savoir plus</h2> <ul><li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-video-element.html#the-video-element" rel="nofollow">Spécification de la balise <code>video</code></a></li> <li><a href="http://my.opera.com/core/blog/2009/12/31/re-introducing-video" rel="nofollow">Comment la balise <code>video</code> est prise en charge dans Opera</a></li> </ul> <h2 id="more">Remerciements</h2> <p>Merci à <a href="http://www.twitter.com/foolip" rel="nofollow">Philippe Jägenstedt</a> pour avoir coder le script JavaScript de l&#39;exemple, David Storey pour ses suggestions précieuses, et ma fille Marina avoir filmé la vidéo  debout sur son lit pendant que je réquisitionnais son bureau.</p><p>Cette traduction, comme l’article original, est placée sous licence Creative Commons, <a rel="nofollow" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">plus d&#39;informations ici</a>.</p>
